<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.user.dao.UserDao">
    <!--统计用户账户数量-->
    <select id="countUserAccount" parameterType="com.user.entity.UserInfo" resultType="int">
        select count(user_account)
        from t_sys_user
        where user_account=#{userAccount}
    </select>
    <!--统计手机号数量-->
    <select id="countUserPhone" parameterType="com.user.entity.UserInfo" resultType="int">
        select count(phone)
        from t_sys_user
        where phone=#{phone}
    </select>
    <!--新增用户-->
    <insert id="addUser" parameterType="com.user.entity.UserInfo">
        insert  into t_sys_user
            (user_id,
            user_name,
            user_account,
            user_pwd,
            id_card,
            sex,
            phone,
            email,
            role,
            is_deleted,
            create_people,
            create_time,
            update_people,
            update_time,
            version)
            values (
            #{userId},
            #{userName},
            #{userAccount},
            #{password},
            #{idCard},
            #{userSex},
            #{phone},
            #{email},
            #{role},
            0,
            #{createPeople},
            now(),
            #{updatePeople},
            now(),
            0
        )
    </insert>
    <!--修改用户-->
    <update id="updateUserById" parameterType="com.user.entity.UserInfo">
        update t_sys_user
        set
           user_name    =#{userName},
           user_account = #{userAccount},
           sex          = #{userSex},
           phone        = #{phone},
           email        = #{email},
           id_card      = #{idCard},
           user_pwd     = #{password},
           update_people= #{updatePeople},
           update_time  =now(),
           version = version+1
        where user_id=#{userId}
        and version=#{version}
    </update>
    <!--删除用户-->
    <delete id="deleteUser" parameterType="com.user.entity.UserInfo">
        update t_sys_user
        set
        is_deleted = 1,
        update_time = now(),
        update_people =#{userId1},
        version = version+1
        where user_id in
        <foreach item="item" index="index" collection="listId" open="(" separator="," close=")">
            #{item}
        </foreach>

    </delete>
    <!--获取用户详情-->
    <select id="findUserById" parameterType="java.lang.String" resultType="com.user.entity.UserDetail">
        select
            user_account  userAccount,
            user_name     userName,
            sex           userSex,
            phone         phone,
            email         email,
            id_card       idCard,
            user_pwd     password,
            role          role
        from t_sys_user
        where
            user_id =#{userId}
        and
            is_deleted=0
    </select>
    <!--用户列表查询-->
    <select id="listUserByPage" parameterType="com.user.entity.UserList" resultType="com.user.entity.UserList">
        select
            a.user_account  userAccount,
            a.user_name     userName,
            a.sex           userSex,
            a.phone         phone,
            a.email         email,
            a.id_card       idCard,
            a.role          role,
            a.user_id       userId,
            a.version       version
        from
            t_sys_user a
        where
            a.is_deleted=0
        <if test="userName != null and userName != ''">
            and a.user_name like concat('%', #{userName}, '%')
        </if>
        <if test="userAccount != null and userAccount != ''">
            and a.user_account like concat('%',#{userAccount},'%')
        </if>
        order by update_time desc
    </select>


    <select id="updateNew" parameterType="com.user.entity.User" resultType="com.user.entity.User">
        select
        a.user_code  userCode,
        a.user_name  userName,
        a.dept_name  deptName
        from
        sys_user a
    </select>

    <insert id="plInset" parameterType="java.util.List" useGeneratedKeys="false">
        insert into sys_user_copy1
        ( user_code,user_name,dept_name,pingying)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.userCode},
            #{item.userName},
            #{item.deptName},
            #{item.pingying}

            )
        </foreach>
    </insert>
</mapper>